version: 2.1
jobs:
  # Membuat workflow bernama build
  build:
    docker:
      - image: docker:17.05.0-ce-git
    steps:
    # Step untuk checkout branch
    - checkout
    # Step untuk menyiapkan environment docker
    - setup_remote_docker
    # Step bernama lint-dockerfile untuk lint Dockerfile
    - run:
        name: lint-dockerfile
        command: docker run --rm --interactive hadolint/hadolint < Dockerfile
    # Step bernama build-app-karsajobs-ui untuk build image dan push ke dockerhub dan github package
    - run:
        name: build-app-karsajobs-ui
        command: |
          echo "Push image ke DockerHub..."
          docker build -t neithroid/karsajobs-ui:latest .
          docker login -u neithroid -p ${PASSWORD_DOCKER_HUB}
          docker push neithroid/karsajobs-ui:latest
          echo "Sukses push image ke repository Docker Hub"
          echo
          echo "Push image ke GitHub Container Registry..."
          docker tag neithroid/karsajobs-ui:latest ghcr.io/dwikie/karsajobs-ui:latest
          docker login ghcr.io -u dwikie -p ${PAT_GITHUB}
          docker push ghcr.io/dwikie/karsajobs-ui:latest
          echo "Sukses push image ke repository GitHub"